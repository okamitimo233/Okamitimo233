<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Key 检测中心 - 现代化仪表盘</title>
  <meta name="description" content="专业的API密钥检测与分析工具，支持多种主流AI服务提供商">
  
  <!-- 1. 加载 Shoelace 样式 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css" />
  
  <!-- 2. 加载 Shoelace 组件脚本 -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace.js"></script>
  
  <!-- 3. 加载 GSAP 及其 ScrollTrigger 插件 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  
  <!-- 4. 加载 Lucide 图标 -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <!-- 5. 自定义 CSS 样式 -->
  <style>
    /* 
     * 全局设计系统
     */
    :root {
      --color-primary: #4a48e0;
      --color-primary-hover: #3b39b3;
      --color-success: #10b981;
      --color-warning: #f59e0b;
      --color-info: #3b82f6;
      --color-danger: #ef4444;
      --color-text-secondary: #667;
      --theme-bg: #f4f7fc;
      --theme-text: #1c1c1e;
      --theme-primary: var(--color-primary);
      --theme-card-bg: #ffffff;
      --theme-card-border: #e5e7eb;
      --theme-header-bg: rgba(244, 247, 252, 0.85);
      --theme-shadow: 0 4px 10px rgba(0,0,0,0.07);
      --theme-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.12);
      --font-family-sans: 'Segoe UI', 'Microsoft YaHei', system-ui, sans-serif;
      --spacing-sm: 8px; --spacing-md: 16px; --spacing-lg: 24px; --spacing-xl: 32px;
      --radius-md: 8px; --radius-lg: 12px; --radius-full: 999px;
    }

    [data-theme="dark"] {
      --color-primary: #58a6ff;
      --color-primary-hover: #79c0ff;
      --color-success: #34d399;
      --color-warning: #fbbf24;
      --color-info: #60a5fa;
      --color-danger: #f87171;
      --color-text-secondary: #909dab;
      --theme-bg: #0d1117;
      --theme-text: #f2f27;
      --theme-card-bg: #161b22;
      --theme-card-border: #30363d;
      --theme-header-bg: rgba(13, 17, 23, 0.85);
      --theme-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      --theme-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    /* 基础样式 */
    *, *::before, *::after { box-sizing: border-box; }
    body { font-family: var(--font-family-sans); background-color: var(--theme-bg); color: var(--theme-text); margin: 0; line-height: 1.6; transition: background-color 0.3s ease, color 0.3s ease; overflow-x: hidden; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 var(--spacing-md); }

    /* 宏观布局 */
    .app-header { display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-sm) var(--spacing-md); height: 64px; position: sticky; top: 0; z-index: 10; background-color: var(--theme-header-bg); backdrop-filter: saturate(180%) blur(10px); -webkit-backdrop-filter: saturate(180%) blur(10px); border-bottom: 1px solid var(--theme-card-border); transition: background-color 0.3s ease, border-color 0.3s ease; }
    .header-left, .header-right { display: flex; align-items: center; gap: var(--spacing-md); }
    .app-title { font-size: 1.5rem; font-weight: 600; text-decoration: none; color: var(--theme-text); display: flex; align-items: center; gap: 10px; }
    .app-title i { color: var(--theme-primary); }
    .main-nav { display: none; }
    .mobile-menu-btn { display: inline-flex; }
    main { padding-top: var(--spacing-lg); }
    .app-footer { text-align: center; padding: var(--spacing-xl) 0; margin-top: var(--spacing-xl); border-top: 1px solid var(--theme-card-border); color: var(--color-text-secondary); font-size: 0.9rem; }

    /* 页面容器 */
    .page { display: none; }
    .page.active { display: block; }

    /* 首页: 导航栏与弹簧指示器 */
    .app-nav { position: relative; display: flex; background-color: var(--theme-card-bg); padding: 6px; border-radius: var(--radius-lg); box-shadow: var(--theme-shadow); margin: var(--spacing-lg) auto 0; max-width: 500px; }
    .nav-indicator { position: absolute; top: 6px; bottom: 6px; left: 0; height: auto; background-color: var(--theme-primary); border-radius: 8px; }
    .nav-tab { flex: 1; padding: 9px 15px; text-align: center; border-radius: 8px; cursor: pointer; font-weight: 500; border: none; background-color: transparent; color: var(--color-text-secondary); transition: color 0.3s ease; z-index: 1; }
    .nav-tab.active { color: #fff; }
    .nav-tab:not(.active):hover { color: var(--theme-text); }
    
    /* 内容区 */
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* 统计卡片 */
    .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-xl); }
    .stat-card { background: var(--theme-card-bg); border-radius: var(--radius-lg); padding: var(--spacing-md); text-align: center; border-left: 4px solid; box-shadow: var(--theme-shadow); transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .stat-card:hover { transform: translateY(-3px); box-shadow: var(--theme-shadow-hover); }
    .stat-card .count { font-size: 2rem; font-weight: 700; color: var(--theme-text); }
    .stat-card .label { font-size: 0.9rem; font-weight: 500; color: var(--color-text-secondary); }
    .stat-valid { border-color: var(--color-success); } .stat-valid .count { color: var(--color-success); }
    .stat-invalid { border-color: var(--color-danger); } .stat-invalid .count { color: var(--color-danger); }
    .stat-timeout { border-color: var(--color-warning); } .stat-timeout .count { color: var(--color-warning); }
    .stat-ratelimit { border-color: var(--color-info); } .stat-ratelimit .count { color: var(--color-info); }
    .stat-truncated { border-color: #ff9800; } .stat-truncated .count { color: #ff9800; }
    .stat-total { border-color: var(--color-text-secondary); } .stat-total .count { color: var(--color-text-secondary); }

    /* 主内容网格 */
    .main-content-grid { display: grid; grid-template-columns: 1fr; gap: var(--spacing-xl); }
    .content-area { display: flex; flex-direction: column; gap: var(--spacing-xl); }
    .sidebar { display: flex; flex-direction: column; gap: var(--spacing-xl); }

    /* 卡片样式 */
    .card { background: var(--theme-card-bg); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--theme-shadow); transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .card:hover { transform: translateY(-2px); box-shadow: var(--theme-shadow-hover); }
    .card-title { font-size: 1.25rem; font-weight: 600; margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-sm); }
    .card-title i { color: var(--theme-primary); }

    /* 输入区域 */
    .input-area { position: relative; margin-bottom: var(--spacing-md); }
    .input-area textarea { width: 100%; min-height: 200px; padding: var(--spacing-md); border: 1px solid var(--theme-card-border); border-radius: var(--radius-md); background-color: var(--theme-bg); color: var(--theme-text); font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; resize: vertical; transition: border-color 0.3s ease; }
    .input-area textarea:focus { outline: none; border-color: var(--theme-primary); }
    .clear-btn { position: absolute; top: var(--spacing-sm); right: var(--spacing-sm); background: none; border: none; color: var(--color-text-secondary); cursor: pointer; font-size: 20px; padding: 4px; border-radius: var(--radius-md); transition: all 0.2s ease; }
    .clear-btn:hover { background-color: var(--theme-card-border); color: var(--theme-text); }

    /* 按钮网格 */
    .controls-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-lg); }
    .control-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: var(--spacing-md); border: 1px solid var(--theme-card-border); border-radius: var(--radius-md); background-color: var(--theme-card-bg); color: var(--theme-text); cursor: pointer; transition: all 0.3s ease; font-size: 14px; font-weight: 500; }
    .control-btn:hover:not(:disabled) { background-color: var(--theme-primary); color: white; border-color: var(--theme-primary); transform: translateY(-2px); box-shadow: var(--theme-shadow); }
    .control-btn:active:not(:disabled) { transform: translateY(0); }
    .control-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .control-btn i { font-size: 24px; }

    /* 进度条 */
    .progress-container { margin-top: var(--spacing-md); }
    .progress-bar { width: 100%; height: 8px; background-color: var(--theme-card-border); border-radius: var(--radius-full); overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--theme-primary), var(--color-primary-hover)); border-radius: var(--radius-full); transition: width 0.3s ease; }
    .progress-text { margin-top: var(--spacing-sm); font-size: 0.9rem; color: var(--color-text-secondary); text-align: center; }

    /* 设置项 */
    .settings-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md); }
    .settings-label { font-size: 14px; color: var(--theme-text); }
    .settings-control { display: flex; align-items: center; gap: var(--spacing-sm); }

    /* 结果卡片 */
    .result-card { background: var(--theme-card-bg); border-radius: var(--radius-lg); padding: var(--spacing-md); margin-bottom: var(--spacing-md); border-left: 4px solid; box-shadow: var(--theme-shadow); transition: all 0.3s ease; }
    .result-card:hover { transform: translateX(4px); box-shadow: var(--theme-shadow-hover); }
    .result-card.valid { border-color: var(--color-success); }
    .result-card.invalid { border-color: var(--color-danger); }
    .result-card.timeout { border-color: var(--color-warning); }
    .result-card.ratelimit { border-color: var(--color-info); }
    .result-card.truncated { border-color: #ff9800; }
    .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-sm); }
    .result-status { font-weight: 600; font-size: 16px; }
    .result-time { font-size: 0.9rem; color: var(--color-text-secondary); }
    .result-key { font-family: monospace; font-size: 13px; word-break: break-all; color: var(--color-text-secondary); cursor: pointer; padding: var(--spacing-sm); background-color: var(--theme-bg); border-radius: var(--radius-md); transition: all 0.2s ease; }
    .result-key:hover { color: var(--theme-primary); background-color: var(--theme-card-border); }

    /* 提供商分组 */
    .provider-group { margin-bottom: var(--spacing-xl); }
    .provider-header { display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-md); background-color: var(--theme-card-bg); border-radius: var(--radius-lg); margin-bottom: var(--spacing-md); cursor: pointer; transition: all 0.3s ease; }
    .provider-header:hover { background-color: var(--theme-card-border); }
    .provider-name { font-weight: 600; font-size: 18px; display: flex; align-items: center; gap: var(--spacing-sm); }
    .provider-stats { display: flex; gap: var(--spacing-sm); }
    .provider-badge { padding: 4px 8px; border-radius: var(--radius-full); font-size: 12px; font-weight: 600; }
    .provider-badge.valid { background-color: var(--color-success); color: white; }
    .provider-badge.invalid { background-color: var(--color-danger); color: white; }
    .provider-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
    .provider-content.expanded { max-height: 5000px; }

    /* 响应式设计 */
    @media (min-width: 768px) {
      .stats-grid { grid-template-columns: repeat(3, 1fr); }
      .controls-grid { grid-template-columns: repeat(4, 1fr); }
    }
    @media (min-width: 992px) {
      .main-nav { display: flex; gap: var(--spacing-sm); }
      .mobile-menu-btn { display: none; }
      .main-content-grid { grid-template-columns: 2fr 1fr; }
      .stats-grid { grid-template-columns: repeat(6, 1fr); }
    }

    /* GSAP 动画覆盖样式 */
    .anim-fade-in-up { opacity: 0; transform: translateY(30px); }
    .anim-stagger-card { opacity: 0; transform: translateY(50px) scale(0.95); }

    /* Toast 通知 */
    .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
    .toast { background: var(--theme-card-bg); color: var(--theme-text); padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md); box-shadow: var(--theme-shadow-hover); border-left: 4px solid var(--theme-primary); min-width: 250px; transform: translateX(100%); transition: transform 0.3s ease; }
    .toast.show { transform: translateX(0); }
    .toast.success { border-color: var(--color-success); }
    .toast.error { border-color: var(--color-danger); }
    .toast.warning { border-color: var(--color-warning); }
    .toast.info { border-color: var(--color-info); }

    /* 模态框 */
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 10000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
    .modal-overlay.show { opacity: 1; pointer-events: auto; }
    .modal { background: var(--theme-card-bg); border-radius: var(--radius-lg); padding: var(--spacing-xl); max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease; }
    .modal-overlay.show .modal { transform: scale(1); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); }
    .modal-title { font-size: 1.5rem; font-weight: 600; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-secondary); }
    .modal-close:hover { color: var(--theme-text); }
  </style>
</head>
<body>

  <header class="app-header">
    <div class="header-left">
      <a href="#" class="app-title" data-page="home">
        <i data-lucide="key"></i>
        <span>API Key 检测中心</span>
      </a>
    </div>
    <div class="header-right">
      <nav class="main-nav">
        <sl-button type="text" data-page="home">检测</sl-button>
        <sl-button type="text" data-page="analysis">分析</sl-button>
        <sl-button type="text" data-page="settings">设置</sl-button>
      </nav>
      <sl-icon-button id="theme-toggle" name="sun" label="切换主题" style="font-size: 1.5rem;"></sl-icon-button>
      <sl-icon-button class="mobile-menu-btn" name="menu" label="打开菜单" style="font-size: 1.5rem;"></sl-icon-button>
    </div>
  </header>

  <sl-drawer class="nav-drawer">
    <span slot="label">
      <i data-lucide="compass" style="font-size: 1.2em;"></i>
      导航
    </span>
    <nav class="drawer-nav">
      <sl-button variant="text" size="large" data-page="home" class="active">
        <i data-lucide="home" slot="prefix"></i>
        检测
      </sl-button>
      <sl-button variant="text" size="large" data-page="analysis">
        <i data-lucide="bar-chart-3" slot="prefix"></i>
        分析
      </sl-button>
      <sl-button variant="text" size="large" data-page="settings">
        <i data-lucide="settings" slot="prefix"></i>
        设置
      </sl-button>
    </nav>
  </sl-drawer>

  <main class="container">
    
    <!-- 检测页面 -->
    <div id="home-page" class="page active">
      <nav class="app-nav" id="app-nav">
        <div class="nav-indicator"></div>
        <button class="nav-tab active" data-tab="batch">批量检测</button>
        <button class="nav-tab" data-tab="single">单个检测</button>
        <button class="nav-tab" data-tab="history">历史记录</button>
      </nav>

      <div style="margin-top: var(--spacing-xl);">
        <!-- 统计卡片 -->
        <section class="stats-grid">
          <div class="stat-card stat-valid anim-stagger-card">
            <div class="count" id="validCount">0</div>
            <div class="label">有效</div>
          </div>
          <div class="stat-card stat-invalid anim-stagger-card">
            <div class="count" id="invalidCount">0</div>
            <div class="label">无效</div>
          </div>
          <div class="stat-card stat-timeout anim-stagger-card">
            <div class="count" id="timeoutCount">0</div>
            <div class="label">超时</div>
          </div>
          <div class="stat-card stat-ratelimit anim-stagger-card">
            <div class="count" id="ratelimitCount">0</div>
            <div class="label">限速</div>
          </div>
          <div class="stat-card stat-truncated anim-stagger-card">
            <div class="count" id="truncatedCount">0</div>
            <div class="label">截断</div>
          </div>
          <div class="stat-card stat-total anim-stagger-card">
            <div class="count" id="totalCount">0</div>
            <div class="label">总数</div>
          </div>
        </section>

        <div class="main-content-grid">
          <!-- 主内容区 -->
          <div class="content-area">
            <!-- 批量检测 -->
            <div id="content-batch" class="tab-content active">
              <div class="card anim-fade-in-up">
                <h2 class="card-title">
                  <i data-lucide="upload"></i>
                  批量导入密钥
                </h2>
                <div class="input-area">
                  <textarea id="apiKeysTextarea" placeholder="每行输入一个 API Key，或用逗号分隔多个密钥..."></textarea>
                  <button class="clear-btn" id="clearBtn" title="清空">
                    <i data-lucide="x"></i>
                  </button>
                </div>
                <div class="controls-grid">
                  <button class="control-btn" id="startBtn">
                    <i data-lucide="play"></i>
                    <span>开始检测</span>
                  </button>
                  <button class="control-btn" id="stopBtn" disabled>
                    <i data-lucide="square"></i>
                    <span>停止检测</span>
                  </button>
                  <button class="control-btn" id="retryBtn" disabled>
                    <i data-lucide="refresh-cw"></i>
                    <span>重试失败</span>
                  </button>
                  <button class="control-btn" id="importBtn">
                    <i data-lucide="file-text"></i>
                    <span>导入文件</span>
                  </button>
                </div>
                <div class="progress-container" id="progressContainer" style="display: none;">
                  <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                  </div>
                  <div class="progress-text" id="progressText">准备中...</div>
                </div>
              </div>

              <!-- 检测结果 -->
              <div class="card anim-fade-in-up">
                <h2 class="card-title">
                  <i data-lucide="list-checks"></i>
                  检测结果
                </h2>
                <div id="resultsContainer">
                  <div style="text-align: center; padding: 40px; color: var(--color-text-secondary);">
                    <i data-lucide="inbox" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <p>暂无检测结果</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- 单个检测 -->
            <div id="content-single" class="tab-content">
              <div class="card anim-fade-in-up">
                <h2 class="card-title">
                  <i data-lucide="key"></i>
                  单个密钥检测
                </h2>
                <div class="input-area">
                  <input type="text" id="singleKeyInput" placeholder="输入单个 API Key..." style="width: 100%; padding: 12px; border: 1px solid var(--theme-card-border); border-radius: var(--radius-md); background-color: var(--theme-bg); color: var(--theme-text); font-family: monospace;">
                </div>
                <div class="controls-grid">
                  <button class="control-btn" id="singleCheckBtn">
                    <i data-lucide="search"></i>
                    <span>检测密钥</span>
                  </button>
                </div>
                <div id="singleResult" style="margin-top: 20px;"></div>
              </div>
            </div>

            <!-- 历史记录 -->
            <div id="content-history" class="tab-content">
              <div class="card anim-fade-in-up">
                <h2 class="card-title">
                  <i data-lucide="history"></i>
                  检测历史
                </h2>
                <div id="historyContainer">
                  <div style="text-align: center; padding: 40px; color: var(--color-text-secondary);">
                    <i data-lucide="clock" style="font-size: 48px; margin-bottom: 16px;"></i>
                    <p>暂无历史记录</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 侧边栏 -->
          <aside class="sidebar">
            <!-- 快速设置 -->
            <div class="card anim-fade-in-up">
              <h3 class="card-title">
                <i data-lucide="settings-2"></i>
                快速设置
              </h3>
              <div class="settings-item">
                <span class="settings-label">并发数</span>
                <div class="settings-control">
                  <sl-input type="number" value="10" min="1" max="50" style="width: 80px;"></sl-input>
                </div>
              </div>
              <div class="settings-item">
                <span class="settings-label">超时时间</span>
                <div class="settings-control">
                  <sl-input type="number" value="10" min="5" max="30" style="width: 80px;"></sl-input>
                  <span style="font-size: 14px; color: var(--color-text-secondary);">秒</span>
                </div>
              </div>
              <div class="settings-item">
                <span class="settings-label">自动重试</span>
                <div class="settings-control">
                  <sl-switch></sl-switch>
                </div>
              </div>
            </div>

            <!-- 支持的服务商 -->
            <div class="card anim-fade-in-up">
              <h3 class="card-title">
                <i data-lucide="shield-check"></i>
                支持的服务商
              </h3>
              <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                <span class="provider-badge valid">OpenAI</span>
                <span class="provider-badge valid">Gemini</span>
                <span class="provider-badge valid">Claude</span>
                <span class="provider-badge valid">DeepSeek</span>
                <span class="provider-badge valid">月之暗面</span>
                <span class="provider-badge valid">智谱AI</span>
                <span class="provider-badge valid">阿里云</span>
                <span class="provider-badge valid">腾讯云</span>
              </div>
            </div>

            <!-- 导出选项 -->
            <div class="card anim-fade-in-up">
              <h3 class="card-title">
                <i data-lucide="download"></i>
                导出选项
              </h3>
              <div style="display: flex; flex-direction: column; gap: 10px;">
                <sl-button variant="default" outline>
                  <i data-lucide="file-text" slot="prefix"></i>
                  导出有效密钥
                </sl-button>
                <sl-button variant="default" outline>
                  <i data-lucide="file-down" slot="prefix"></i>
                  导出完整报告
                </sl-button>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>

    <!-- 分析页面 -->
    <div id="analysis-page" class="page">
      <div class="card anim-fade-in-up">
        <h2 class="card-title">
          <i data-lucide="bar-chart-3"></i>
          数据分析
        </h2>
        <div style="text-align: center; padding: 60px; color: var(--color-text-secondary);">
          <i data-lucide="pie-chart" style="font-size: 64px; margin-bottom: 20px;"></i>
          <p>数据分析功能正在开发中...</p>
        </div>
      </div>
    </div>

    <!-- 设置页面 -->
    <div id="settings-page" class="page">
      <div class="card anim-fade-in-up">
        <h2 class="card-title">
          <i data-lucide="settings"></i>
          高级设置
        </h2>
        <div style="text-align: center; padding: 60px; color: var(--color-text-secondary);">
          <i data-lucide="sliders" style="font-size: 64px; margin-bottom: 20px;"></i>
          <p>高级设置功能正在开发中...</p>
        </div>
      </div>
    </div>

  </main>

  <footer class="app-footer">
    <p>&copy; 2025 API Key 检测中心. All Rights Reserved.</p>
    <p>支持 OpenAI、Gemini、Claude 等 10+ 主流 AI 服务</p>
  </footer>

  <!-- Toast 容器 -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- 模态框 -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">标题</h3>
        <button class="modal-close" id="modalClose">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body" id="modalBody">
        内容
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 初始化 Lucide 图标
      lucide.createIcons();
      
      // 注册 GSAP 插件
      gsap.registerPlugin(ScrollTrigger);

      // 全局变量
      let isChecking = false;
      let checkResults = [];
      let currentTheme = 'light';

      // 主题切换
      const themeToggle = document.getElementById('theme-toggle');
      const html = document.documentElement;
      
      themeToggle.addEventListener('click', () => {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        html.setAttribute('data-theme', currentTheme);
        themeToggle.name = currentTheme === 'light' ? 'sun' : 'moon';
        localStorage.setItem('theme', currentTheme);
        
        // 重新创建图标以更新颜色
        lucide.createIcons();
      });

      // 加载保存的主题
      const savedTheme = localStorage.getItem('theme') || 'light';
      currentTheme = savedTheme;
      html.setAttribute('data-theme', savedTheme);
      themeToggle.name = savedTheme === 'light' ? 'sun' : 'moon';

      // 页面切换
      const pages = {
        home: document.getElementById('home-page'),
        analysis: document.getElementById('analysis-page'),
        settings: document.getElementById('settings-page')
      };
      
      const navLinks = document.querySelectorAll('[data-page]');
      
      function switchPage(pageName) {
        const currentPage = document.querySelector('.page.active');
        const nextPage = pages[pageName];

        if (currentPage === nextPage) return;

        navLinks.forEach(link => {
          link.classList.toggle('active', link.dataset.page === pageName);
        });

        const tl = gsap.timeline();
        tl.to(currentPage, {
          duration: 0.3,
          opacity: 0,
          y: -20,
          onComplete: () => {
            currentPage.classList.remove('active');
            nextPage.classList.add('active');
            ScrollTrigger.refresh();
          }
        })
        .fromTo(nextPage, 
          { opacity: 0, y: 20 },
          { duration: 0.4, opacity: 1, y: 0, ease: "power2.out" }
        );
      }

      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const pageName = link.dataset.page;
          switchPage(pageName);
          
          // 关闭移动端抽屉
          const drawer = document.querySelector('.nav-drawer');
          if (drawer && drawer.open) {
            drawer.hide();
          }
        });
      });

      // 移动端菜单
      const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
      const drawer = document.querySelector('.nav-drawer');
      
      mobileMenuBtn.addEventListener('click', () => {
        drawer.show();
      });

      // Tab 切换（首页）
      const appNav = document.getElementById('app-nav');
      const navIndicator = appNav.querySelector('.nav-indicator');
      const navTabs = appNav.querySelectorAll('.nav-tab');
      const tabContents = document.querySelectorAll('.tab-content');

      gsap.set(navIndicator, {
        width: navTabs[0].offsetWidth,
        x: navTabs[0].offsetLeft
      });

      navTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          if (tab.classList.contains('active')) return;

          const currentActiveTab = appNav.querySelector('.nav-tab.active');
          const currentContent = document.querySelector('.tab-content.active');
          const newContentId = `content-${tab.dataset.tab}`;
          const newContent = document.getElementById(newContentId);

          currentActiveTab.classList.remove('active');
          tab.classList.add('active');

          const tl = gsap.timeline();
          tl.to(navIndicator, {
            duration: 0.6,
            width: tab.offsetWidth,
            x: tab.offsetLeft,
            ease: "elastic.out(1, 0.5)"
          });

          if (currentContent) {
            tl.to(currentContent, {
              duration: 0.3,
              opacity: 0,
              y: -10,
              onComplete: () => {
                currentContent.classList.remove('active');
                currentContent.style.opacity = 1;
                currentContent.style.transform = 'translateY(0)';
              }
            }, "<");
          }

          if (newContent) {
            newContent.classList.add('active');
            gsap.fromTo(newContent, 
              { opacity: 0, y: 10 },
              { duration: 0.4, opacity: 1, y: 0, ease: "power2.out" }
            );
          }
        });
      });

      // Toast 通知
      function showToast(message, type = 'info', duration = 3000) {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        container.appendChild(toast);

        // 触发动画
        gsap.fromTo(toast, 
          { x: 100, opacity: 0 },
          { x: 0, opacity: 1, duration: 0.3, ease: "power2.out" }
        );

        // 自动移除
        setTimeout(() => {
          gsap.to(toast, {
            x: 100,
            opacity: 0,
            duration: 0.3,
            ease: "power2.in",
            onComplete: () => {
              container.removeChild(toast);
            }
          });
        }, duration);
      }

      // 模态框
      const modalOverlay = document.getElementById('modalOverlay');
      const modalTitle = document.getElementById('modalTitle');
      const modalBody = document.getElementById('modalBody');
      const modalClose = document.getElementById('modalClose');

      function showModal(title, content) {
        modalTitle.textContent = title;
        modalBody.innerHTML = content;
        modalOverlay.classList.add('show');
        
        // 重新创建图标
        lucide.createIcons();
      }

      function hideModal() {
        modalOverlay.classList.remove('show');
      }

      modalClose.addEventListener('click', hideModal);
      modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) {
          hideModal();
        }
      });

      // 清空按钮
      document.getElementById('clearBtn').addEventListener('click', () => {
        document.getElementById('apiKeysTextarea').value = '';
        showToast('已清空输入', 'info');
      });

      // 开始检测
      document.getElementById('startBtn').addEventListener('click', async () => {
        const textarea = document.getElementById('apiKeysTextarea');
        const keys = textarea.value.trim().split(/[\n,]/).map(k => k.trim()).filter(k => k);
        
        if (keys.length === 0) {
          showToast('请输入至少一个 API Key', 'warning');
          return;
        }

        isChecking = true;
        checkResults = [];
        
        // 更新按钮状态
        document.getElementById('startBtn').disabled = true;
        document.getElementById('stopBtn').disabled = false;
        document.getElementById('retryBtn').disabled = true;
        
        // 显示进度条
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        progressContainer.style.display = 'block';
        
        // 清空结果
        const resultsContainer = document.getElementById('resultsContainer');
        resultsContainer.innerHTML = '';

        // 模拟检测过程
        for (let i = 0; i < keys.length; i++) {
          if (!isChecking) break;
          
          const key = keys[i];
          const progress = ((i + 1) / keys.length) * 100;
          
          progressFill.style.width = `${progress}%`;
          progressText.textContent = `检测中... ${i + 1}/${keys.length}`;
          
          // 模拟异步检测
          await new Promise(resolve => setTimeout(resolve, 500));
          
          // 生成模拟结果
          const statuses = ['valid', 'invalid', 'timeout', 'ratelimit'];
          const providers = ['OpenAI', 'Gemini', 'Claude', 'DeepSeek'];
          const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
          const randomProvider = providers[Math.floor(Math.random() * providers.length)];
          
          const result = {
            key: key.substring(0, 20) + '...',
            status: randomStatus,
            provider: randomProvider,
            time: Math.floor(Math.random() * 1000) + 100
          };
          
          checkResults.push(result);
          addResultCard(result);
          updateStats();
        }
        
        // 完成
        isChecking = false;
        document.getElementById('startBtn').disabled = false;
        document.getElementById('stopBtn').disabled = true;
        document.getElementById('retryBtn').disabled = false;
        
        progressText.textContent = `检测完成！共检测 ${keys.length} 个密钥`;
        showToast(`检测完成！有效 ${checkResults.filter(r => r.status === 'valid').length} 个`, 'success');
      });

      // 停止检测
      document.getElementById('stopBtn').addEventListener('click', () => {
        isChecking = false;
        document.getElementById('startBtn').disabled = false;
        document.getElementById('stopBtn').disabled = true;
        showToast('已停止检测', 'info');
      });

      // 添加结果卡片
      function addResultCard(result) {
        const resultsContainer = document.getElementById('resultsContainer');
        
        // 按提供商分组
        let providerGroup = document.querySelector(`[data-provider="${result.provider}"]`);
        if (!providerGroup) {
          providerGroup = document.createElement('div');
          providerGroup.className = 'provider-group';
          providerGroup.dataset.provider = result.provider;
          
          providerGroup.innerHTML = `
            <div class="provider-header">
              <div class="provider-name">
                <i data-lucide="shield-check"></i>
                ${result.provider}
              </div>
              <div class="provider-stats">
                <span class="provider-badge valid">0</span>
                <span class="provider-badge invalid">0</span>
              </div>
            </div>
            <div class="provider-content"></div>
          `;
          
          resultsContainer.appendChild(providerGroup);
          
          // 添加展开/收起功能
          const header = providerGroup.querySelector('.provider-header');
          const content = providerGroup.querySelector('.provider-content');
          
          header.addEventListener('click', () => {
            content.classList.toggle('expanded');
            const icon = header.querySelector('i');
            if (content.classList.contains('expanded')) {
              gsap.to(icon, { rotation: 90, duration: 0.3 });
            } else {
              gsap.to(icon, { rotation: 0, duration: 0.3 });
            }
          });
        }
        
        const content = providerGroup.querySelector('.provider-content');
        const resultCard = document.createElement('div');
        resultCard.className = `result-card ${result.status}`;
        
        const statusText = {
          valid: '✅ 有效',
          invalid: '❌ 无效',
          timeout: '⏰ 超时',
          ratelimit: '⚠️ 限速'
        };
        
        resultCard.innerHTML = `
          <div class="result-header">
            <span class="result-status">${statusText[result.status]}</span>
            <span class="result-time">${result.time}ms</span>
          </div>
          <div class="result-key" title="点击复制">${result.key}</div>
        `;
        
        content.appendChild(resultCard);
        
        // 更新提供商统计
        const validBadge = providerGroup.querySelector('.provider-badge.valid');
        const invalidBadge = providerGroup.querySelector('.provider-badge.invalid');
        
        if (result.status === 'valid') {
          validBadge.textContent = parseInt(validBadge.textContent) + 1;
        } else {
          invalidBadge.textContent = parseInt(invalidBadge.textContent) + 1;
        }
        
        // 添加动画
        gsap.fromTo(resultCard, 
          { opacity: 0, y: 20 },
          { opacity: 1, y: 0, duration: 0.3, ease: "power2.out" }
        );
        
        // 重新创建图标
        lucide.createIcons();
        
        // 添加复制功能
        const keyElement = resultCard.querySelector('.result-key');
        keyElement.addEventListener('click', () => {
          navigator.clipboard.writeText(result.key).then(() => {
            showToast('已复制到剪贴板', 'success');
          });
        });
      }

      // 更新统计
      function updateStats() {
        const stats = {
          valid: 0,
          invalid: 0,
          timeout: 0,
          ratelimit: 0,
          truncated: 0,
          total: checkResults.length
        };
        
        checkResults.forEach(result => {
          stats[result.status]++;
        });
        
        // 使用 GSAP 动画更新数字
        Object.keys(stats).forEach(key => {
          const element = document.getElementById(`${key}Count`);
          if (element) {
            const current = parseInt(element.textContent);
            gsap.to(element, {
              innerHTML: stats[key],
              duration: 0.5,
              ease: "power2.out",
              snap: { innerHTML: 1 }
            });
          }
        });
      }

      // 单个密钥检测
      document.getElementById('singleCheckBtn').addEventListener('click', async () => {
        const input = document.getElementById('singleKeyInput');
        const key = input.value.trim();
        
        if (!key) {
          showToast('请输入 API Key', 'warning');
          return;
        }
        
        const btn = document.getElementById('singleCheckBtn');
        btn.disabled = true;
        btn.innerHTML = '<i data-lucide="loader-2"></i><span>检测中...</span>';
        lucide.createIcons();
        
        // 模拟检测
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        const resultContainer = document.getElementById('singleResult');
        const isValid = Math.random() > 0.3;
        
        resultContainer.innerHTML = `
          <div class="result-card ${isValid ? 'valid' : 'invalid'}">
            <div class="result-header">
              <span class="result-status">${isValid ? '✅ 有效' : '❌ 无效'}</span>
              <span class="result-time">${Math.floor(Math.random() * 500) + 100}ms</span>
            </div>
            <div class="result-key">${key}</div>
          </div>
        `;
        
        gsap.fromTo(resultContainer.firstElementChild, 
          { opacity: 0, scale: 0.9 },
          { opacity: 1, scale: 1, duration: 0.3, ease: "back.out(1.7)" }
        );
        
        btn.disabled = false;
        btn.innerHTML = '<i data-lucide="search"></i><span>检测密钥</span>';
        lucide.createIcons();
        
        showToast(isValid ? '密钥有效' : '密钥无效', isValid ? 'success' : 'error');
      });

      // 导入文件
      document.getElementById('importBtn').addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.txt';
        
        input.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = (e) => {
            const content = e.target.result;
            document.getElementById('apiKeysTextarea').value = content;
            showToast('文件导入成功', 'success');
          };
          reader.readAsText(file);
        });
        
        input.click();
      });

      // GSAP 滚动动画
      const animElements = gsap.utils.toArray('.anim-stagger-card, .anim-fade-in-up');
      animElements.forEach(el => {
        gsap.fromTo(el, 
          el.classList.contains('anim-fade-in-up') 
            ? { y: 30, opacity: 0 }
            : { y: 50, opacity: 0, scale: 0.98 },
          {
            y: 0,
            opacity: 1,
            scale: 1,
            duration: 0.6,
            ease: "power2.out",
            scrollTrigger: {
              trigger: el,
              start: "top 85%",
              toggleActions: "play none none reverse"
            }
          }
        );
      });

      // 统计卡片错开动画
      gsap.fromTo(".stats-grid .anim-stagger-card", 
        { y: 50, opacity: 0, scale: 0.95 },
        {
          y: 0,
          opacity: 1,
          scale: 1,
          duration: 0.6,
          ease: "power2.out",
          stagger: 0.1,
          scrollTrigger: {
            trigger: ".stats-grid",
            start: "top 85%",
          }
        }
      );

      // 卡片悬停效果
      const cards = document.querySelectorAll('.card, .stat-card');
      cards.forEach(card => {
        card.addEventListener('mouseenter', () => {
          gsap.to(card, {
            duration: 0.3,
            y: -4,
            boxShadow: "0 12px 30px rgba(0, 0, 0, 0.15)",
            ease: "power2.out"
          });
        });
        
        card.addEventListener('mouseleave', () => {
          gsap.to(card, {
            duration: 0.3,
            y: 0,
            boxShadow: "0 4px 10px rgba(0,0,0,0.07)",
            ease: "power2.out"
          });
        });
      });

      // 初始化
      updateStats();
    });
  </script>
</body>
</html>